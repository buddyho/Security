{% extends "backend/common/layout.html" %}
{% block vulnerability_active %}active{% endblock %}
{% block nav_first %}Dashboards{% endblock %}
{% block nav_second %}{{ data.title }}{% endblock %}
{% block body %}
    <hr class="aky">
    <form role="form">
        <input type="hidden" name="type" value="{{ data.type }}">
        <input type="hidden" name="id" value="{{ data.id }}">
        <div class="aol">
            <input type="text" class="form-control" name="name" value="{{ data.vulnerability.name }}" placeholder="Name">
            <span class="bv ade"></span>
        </div>
        <div class="aol">
            <input type="text" class="form-control" name="third_v_id" value="{{ data.vulnerability.third_v_id }}" placeholder="Third-party VID"/>
            <span class="bv ade"></span>
        </div>
        <div class="form-group">
            <label for="description">Description</label>
            <input type="text" class="form-control" name="description" value="{{ data.vulnerability.description }}" placeholder="Vulnerability description"/>
        </div>
        <div class="form-group">
            <label for="repair">Repair</label>
            <input type="text" class="form-control" name="repair" value="{{ data.vulnerability.repair }}" placeholder="Vulnerability repair"/>
        </div>
        <hr class="aky">
        <div class="aon hj akg">
            <div class="akh aki">
                <button type="button" name="submit" class="ce apk fh">Submit</button>
            </div>
            <div class="akh">
                <button class="ce fh apr delete" type="button">
                    <span class="bv xm"></span> Delete
                </button>
            </div>
        </div>
    </form>
{% endblock %}
{% block scripts %}
    <script>
        var app = {
            id: function () {
                return $('input[name=id]').val();
            },
            type: function () {
                return $('input[name=type]').val()
            },
            init: function () {
                $('button[name=submit]').click(function () {
                    var name = $('input[name=name]').val();
                    var description = $('input[name=description]').val();
                    var repair = $('input[name=repair]').val();
                    var third_v_id = $('input[name=third_v_id]').val();

                    if (!name || name == "") {
                        notification('name can not be empty!');
                        return false;
                    }
                    if (!description || description == "") {
                        notification('description can not be empty!');
                        return false;
                    }
                    if (!repair || repair == "") {
                        notification('path can not be empty!');
                        return false;
                    }
                    if (!third_v_id || third_v_id == "") {
                        notification('third_v_id cannot be empty!');
                        return false;
                    }

                    data = {
                        'name': name,
                        'description': description,
                        'repair': repair,
                        'third_v_id': third_v_id
                    };
                    $.post('/admin/vulnerability/' + app.type() + '/' + app.id(), data, function (ret) {
                        if (ret.code == 1001) {
                            window.location.href = '/admin/vulnerability/';
                        } else {
                            notification(ret.message);
                        }
                    });
                });

                if (app.type() == 'create') {
                    $('.delete').hide();
                }

                $('button.delete').click(function () {
                    var button = $(this);
                    var id = button.parents('tr').attr('data-id');
                    if (window.confirm('Do you want to delete this vulnerability? (ID:' + app.id() + ')')) {
                        $.post("/admin/vulnerability/delete", {id: app.id()}, function (ret) {
                            if (ret.code == 1001) {
                                window.history.go(-1)
                            } else {
                                alert(data.message);
                            }
                        });
                    }
                });
            }
        };
        app.init();
    </script>
{% endblock %}